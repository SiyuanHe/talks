<!doctype html>  
<html lang="en">

	<head>
		<meta charset="utf-8">
		
		<title>Modern concurrency: Erlang, Scala, Go, Clojure</title>

		<meta name="description" content="Modern concurrency: Erlang, Scala, Go, Clojure">
		<meta name="author" content="Alexey Kachayev">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		
		<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	
	<body>
	<div class="reveal">
	<div class="slides">

		<section>
			<h1>Modern concurrency:</h1> 
            <h2 style="color: #40FF00">Erlang, Scala, Go, Clojure</h2>
			<h2>by Alexey Kachayev, 2013</h2>
		</section>

        <section>
            <h2>About me</h2>
            <br/>
            <ul>
                <li>Position: CTO at Kitapps Inc.</li>
                <li>Production experience: Python, Java, JS, Go, Scala, Clojure, Erlang</li>
                <li>Looked at: Haskell, Lisp, Scheme</li>
            </ul>
            <br />
            <br />
            <h2>Where to find?</h2>
            <ul>
                <li>Twitter: @kachayev</li>
                <li>Github: @kachayev</li>
            </ul>
        </section>

        <section>
            <h2>What we are going to talk about?</h2>
            <br />
            <br />
            <ul>
                <li>More about concurrency, (much!) less about parallelism</li>
                <li>Tasks: from practise and from theory</li>
                <li>Classical approach and problems: threads/locks/mutex</li>
                <li>One task, different solutions: Actors, Channels, Agents and STM</li>
                <li>What to choose and how to live with all this stuff?</li>
                <li>p.s. Why functional programming matters</li>
            </ul>
        </section>

        <section>
            <h2>Concurrency is not parallelism</h2>
             <br />
            <p>Rob Pike:</p>
            <blockquote>
Concurrency is the composition of independently executing computations.
Concurrency is a way to structure software, particularly as a way to write clean code that interacts well with the real world.
            </blockquote>
            <p><a href="http://vimeo.com/49718712">Video "Concurrency is not parallelism"</a></p>
        </section>

        <section>
            <h2>Tasks</h2>
            <br />
            <ul>
                <li>Theory: <a href="http://en.wikipedia.org/wiki/Sleeping_barber_problem">Sleeping barber problem</a></li>
                <li>Practise: Cache manager for image viewer (you want to show several images on mobile screen downloaded from server, but you are hardly limited in free memory and disk space)</li>
            </ul>
            <br />
            <br />
            <br />
            <p> 
                - Why should we solve this stupid theoretical tasks? <br />
                - Cause any task from practise is much more harder 
            </p> 
            <p style="font-size: smaller">Need more tasks from practise? Ping me after talk.</p>
        </section>

        <!-- TODO: slide with cache manage description -->
        <section>
            <h2>Hah, it's easy. Use locks, Luke!</h2>
            <br />

            <p>"Classical" approach, each thread:
            <ul>
                <li>check resource on disc</li>
                <li>"lock" hash map, check if someone download the same, "unlock" </li>
                <li>check HTTP head for Content-Length</li>
                <li>"lock" free space counter, try to subtrackt size, "unlock"</li>
                <li>if succesfull, read from HTTP body to disk</li>
                <li>if not, call somebody who will remove old file(s)</li>
            </ul>
        </section>

        <section>
            <h2>Hah, it's easy. Use locks, Luke!</h2>
            <br />

            <p>Hmmm, really?</p>
            <ul>
                <li>What to do with crashes during dowloading image?</li>
                <li>What to do with "waiters" and how to manage free space on concurrent +/- operations?</li>
                <li>How to manage free space more "smart": 10 * 1 mb is better that 1 * 10 mb?</li>
                <li>How to "kill" task if image is not necessary (before it downloaded)?</li>
                <li>How this program will work if we run 1000 "downloaders"?</li>
                <li style="color:  #FA5858">Are you sure that your locks are good enough???</li>
            </ul>

        </section>

        <section>
            <h2>What the problem is with locks?</h2>
            <br />
            <p>Jonas Boner, <a href="http://www.slideshare.net/jboner/building-scalable-highly-concurrent-fault-tolerant-systems-lessons-learned">about fault-tolerant scaling</a>:
            <br />
            <br />
            <ul>
                <li>Locks do not compose</li>
                <li>Locks breaks encaplutaion <i>(you need to know a lot!)</i></li>
                <li>Taking too few locks</li>
                <li>Taking too many locks</li>
                <li>Taking the wrong locks</li>
                <li>Taking locks in wrong order</li>
                <li>Error recovery is hard</li>
            </ul>
        </section>

        <section>
            <h2>What the problem is with locks?</h2>
            <br />

            <ul>
                <li>It's not the nature of our world!!! (we don't ask world to stop to do something)</li>
                <li>What to do with crashes in critical section?</li>
                <li>Impossible to test: you will know about problem only "in production"</li>
            </ul>
        </section>

        <section>
            <h2>Modern concurrency</h2>
            <br />
            <ul>
                <li>Actors (message passing)</li>
                <li>STM (Software Transactional Memory)</li>
                <li>Dataflow Concurrency (<a href="http://doc.akka.io/docs/akka/snapshot/scala/dataflow.html">your homework</a>)</li>
            </ul>
        </section>

        <section>
            <h2>What does actor looks like? (Theory)</h2>
            <br />

            <ul>
                <li>Separated isolated lightweight processes (actor)</li>
                <li>Share nothing, avoid side-effects (FP)</li>
                <li>Pure message passing communication (mailbox)</li>
                <li>Location transparency</li>
            </ul>
        </section>

        <section>
            <h2>What does actor looks like? (Go)</h2>

            <!-- code samples for Go -->
        </section>

        <section>
            <h2>What does actor looks like? (Scala)</h2>

            <!-- code samples for Scala -->
        </section>

        <section>
            <h2>Go Channels</h2>

            <!-- code samples for Go -->
        </section>

        <section>
            <h2>Go Channels</h2>

            <br />
            <p>"Rough analogy: writing to a file by name (process, Erlang) vs. writing to a file descriptor (channel, Go)." (c) Rob Pike</p>
            <br />
            <br />
            <p>"Rough analogy: Assume Go channels as portable actor mailboxes" (c) Me</p>
        </section>

        <section>
            <h2>Clojure concurrency primitives</h2>
            <br />

            <ul>
                <li>Desinged for <a href="http://clojure.org/concurrent_programming">concurrency</a></li>
                <li>Identity and value are different things</li>
                <li>Different approaches for sharing changing state</li>
                <li>Software transactional memory - synchronous and coordinated approach (memory as database, with transactions and rollbacks)</li>
                <li>Agent(s) - asynchronous and independent approach</li>
                <li>Atom(s) - synchronous and independent approach</li>
            </ul>
        </section>

        <section>
            <h2>Clojure concurrency primitives</h2>

            <!-- clojure code with solution -->
        </section>

        <section>
            <h2>Clojure concurrency primitives</h2>

            <br />
            <p>Why functional programming matters in Clojure: </p>
            <br />
            <ul>
                <li>Side-effects free functions</li>
                <li>Deterministic functions/calculations</li>
            </ul>
        </section>

        <section>
            <h2>How to live with this</h2>

            <br />
            <p><i>- I can write the same as Scala/Clojure/Go in Java/Python/..!<br />- hah, <span style="color:  #FA5858">really</span>...?</i></p>
            <br /><br />
    
            <p>Everything that <span style="color:  #FA5858">can</span> go wrong <span style="color:  #FA5858">will</span> go wrong (c) Murphy</p>
        </section>

        <section>

            <h2>How to live with this</h2>
            <br />

            <p><a href="http://stackoverflow.com/questions/14298523/why-does-adding-concurrency-slow-down-this-golang-code">Quetion</a>: Why does adding concurrency slow down this golang code?</p>

            <br />
            <p>Answer: The issue seems to come from your use of <code>rand.Float64()</code>, which uses a <span style="color:  #FA5858">shared global</span> object with a <span style="color:  #FA5858">Mutex lock</span> on it.</p>

        </section>

        <section>
            <h2>What to choose</h2>

            <br />
            <ul>
                <li>Use most natural approach for you technology / OP (there are many STM implementations, but in Clojure it's basic idea)</li>
                <li>Use "unusual" approach but remember that now only conventions rule</li>
                <li>If you need distributed concurrency - use actors</li>
            </ul>
        </section>


        <section>
            <h2>What to choose</h2>

            <br />
            <p>For Scala developers from <a href="http://www.slideshare.net/jboner/building-scalable-highly-concurrent-fault-tolerant-systems-lessons-learned">Jonas Boner</a>:
            <ul>
                <li>Start with deterministic, declarative, immutable core</li>
                <li>Add indeterminism selectively (actors)</li>
                <li>Add mutability selectively (STM)</li>
                <li>Finally: add locks and explicit threads</li>
            </ul>
        </section>

        <section>
            <h2>Any questions?</h2>
            <br />
            <br />
            <br />
            <h2 style="color:  #FA5858">Thanks for your attention</h3>
        </section>

		</div>
	    </div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>
			
			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				
				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/highlight.js', async: true, callback: function() { window.hljs.initHighlightingOnLoad(); } },
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'lib/js/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'lib/js/data-markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/zoom-js/zoom.js', condition: function() { return !!document.body.classList; } },
					{ src: '/socket.io/socket.io.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } },
					{ src: 'plugin/speakernotes/client.js', async: true, condition: function() { return window.location.host === 'localhost:1947'; } }
				]
			});
			
		</script>

	</body>
</html>
